<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <script src="https://unpkg.com/eventemitter3@latest/dist/eventemitter3.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/roslib@1/build/roslib.min.js"></script>

  <script>
    // Connecting to ROS
    // -----------------
    var ros = new ROSLIB.Ros();

    // If there is an error on the backend, an 'error' emit will be emitted.
    ros.on('error', function (error) {
      console.error("Socket Error\n" + error);
      document.getElementById('connecting').style.display = 'none';
      document.getElementById('connected').style.display = 'none';
      document.getElementById('closed').style.display = 'none';
      document.getElementById('error').style.display = 'inline';
    });

    // Find out exactly when we made a connection.
    ros.on('connection', function () {
      console.log('Connected!');
      document.getElementById('connecting').style.display = 'none';
      document.getElementById('error').style.display = 'none';
      document.getElementById('closed').style.display = 'none';
      document.getElementById('connected').style.display = 'inline';
    });

    ros.on('close', function () {
      console.log('Disconnected!');
      document.getElementById('connecting').style.display = 'none';
      document.getElementById('connected').style.display = 'none';
      document.getElementById('closed').style.display = 'inline';
    });

    // Subscribing to a Topic
    // ----------------------

    // Like when publishing a topic, we first create a Topic object with details of the topic's name
    // and message type. Note that we can call publish or subscribe on the same topic object.
    var listener = new ROSLIB.Topic({
      ros: ros,
      name: "/rt_bi_behavior/dot_renderer",
      messageType: "std_msgs/String"
    });

    // Then we add a callback to be called every time a message is published on this topic.
    listener.subscribe(function (msg) {
      data = JSON.parse(msg.data)
      el = document.getElementById("ba-name").innerHTML = data.name
      el = document.getElementById("dot-graph").innerHTML = data.svg
    });

    // Create a connection to the rosbridge WebSocket server.
    ros.connect('ws://192.168.1.169:9090');
  </script>
</head>

<body>
  <h1>Behavior Automaton: <span id="ba-name"></span></h1>
  <div id="statusIndicator">
    <p id="connecting">
      Connecting to rosbridge...
    </p>
    <p id="connected" style="color:#00D600; display:none">
      Connected
    </p>
    <p id="error" style="color:#FF0000; display:none">
      Error in the backend!
    </p>
    <p id="closed" style="display:none">
      Connection closed.
    </p>
  </div>
  <div id="dot-graph" style="text-align: center;">
    <h2>SVG</h2>
  </div>
</body>

</html>
